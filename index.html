<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Miglior Fashion Store</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
  
  <style>
    :root { --primary: #2c3e50; --accent: #c0392b; --bg-light: #f8f9fa; --text-main: #2c3e50; }
    body { font-family: 'Lato', sans-serif; color: var(--text-main); background-color: #fff; padding-top: 70px; display: flex; flex-direction: column; min-height: 100vh; }
    #app { flex: 1; }
    
    /* Navbar */
    .navbar { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
    .brand-logo { font-family: 'Cinzel', serif; font-weight: 700; letter-spacing: 2px; font-size: 1.5rem; color: #000; text-decoration: none; }
    
    /* Hero Carousel */
    .hero-section { height: 75vh; width: 100%; position: relative; background: #eee; }
    .carousel-item, .carousel-inner, .hero-section .carousel { height: 100%; }
    .carousel-item img { object-fit: cover; height: 100%; width: 100%; }
    .hero-overlay { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.3); z-index: 10; display: flex; align-items: center; justify-content: center; }
    .hero-content { position: relative; z-index: 20; color: white; text-align: center; }
    .hero-title { font-family: 'Cinzel', serif; font-size: 3.5rem; margin-bottom: 1rem; text-shadow: 0 2px 4px rgba(0,0,0,0.5); }
    
    .btn-hero { border: 2px solid #fff; color: #fff; padding: 12px 30px; font-size: 1.1rem; text-transform: uppercase; letter-spacing: 1px; transition: 0.3s; background: transparent; }
    .btn-hero:hover { background: #fff; color: #000; }
    
    /* Marquee */
    .marquee-container { padding: 10px 0; overflow: hidden; position: relative; white-space: nowrap; }
    .marquee-content { display: inline-block; padding-left: 100%; animation: marquee linear infinite; font-size: 0.9rem; letter-spacing: 1px; }
    @keyframes marquee { 0% { transform: translate(0, 0); } 100% { transform: translate(-100%, 0); } }

    /* Social Sidebar */
    .social-sidebar { position: fixed; bottom: 20px; left: 20px; z-index: 1000; display: flex; flex-direction: column; gap: 10px; }
    .social-btn { width: 45px; height: 45px; background: #fff; border-radius: 50%; display: flex; justify-content: center; align-items: center; box-shadow: 0 4px 10px rgba(0,0,0,0.15); transition: transform 0.2s; color: #333; font-size: 1.2rem; text-decoration: none; }
    .social-btn:hover { transform: translateY(-3px); color: var(--accent); }
    .social-btn.fb:hover { color: #1877F2; }
    .social-btn.ig:hover { color: #E4405F; }
    .social-btn.line:hover { color: #00C300; }

    /* Products */
    .product-card { border: none; transition: transform 0.3s; cursor: pointer; }
    .product-card:hover { transform: translateY(-5px); }
    .product-img-wrapper { position: relative; overflow: hidden; padding-top: 133%; }
    .product-img { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; }
    
    /* Tags Container Fix */
    .tags-container { position: absolute; top: 10px; left: 10px; display: flex; flex-direction: column; gap: 5px; align-items: flex-start; z-index: 5; }
    .badge-tag { padding: 5px 10px; font-size: 0.8rem; text-transform: uppercase; letter-spacing: 1px; color: #fff; background: #000; border-radius: 2px; }
    .tag-sale { background: var(--accent); } /* Special color for Hot/Sale */
    
    .spec-btn { border: 1px solid #ddd; background: #fff; color: #333; margin-right: 8px; margin-bottom: 8px; border-radius: 0; min-width: 40px; }
    .spec-btn.active { border-color: #000; background: #000; color: #fff; }
    .cart-badge { position: absolute; top: 0; right: 0; font-size: 0.7rem; transform: translate(50%, -10%); }
    .loading-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.9); z-index: 9999; display: flex; justify-content: center; align-items: center; }
    
    /* Footer */
    .footer { background-color: #f8f9fa; padding: 40px 0; margin-top: auto; border-top: 1px solid #e9ecef; }
    .footer a { color: #6c757d; text-decoration: none; transition: 0.2s; }
    .footer a:hover { color: #2c3e50; }
    
    /* Admin Styles */
    .admin-sidebar { height: 100%; background: #2c3e50; color: white; min-height: 80vh; padding: 20px 0; }
    .admin-menu-item { display: block; padding: 15px 20px; color: rgba(255,255,255,0.7); text-decoration: none; cursor: pointer; transition: 0.2s; }
    .admin-menu-item:hover, .admin-menu-item.active { background: rgba(255,255,255,0.1); color: white; border-left: 4px solid var(--accent); }
    .admin-content { padding: 30px; background: #f8f9fa; height: 100%; }
    
    /* Rich Text Editor */
    .rich-editor { height: 200px; overflow-y: auto; background: white; border-top: 0; }
    .editor-toolbar { background: #f8f9fa; padding: 5px; border-bottom: 1px solid #ddd; }
    [contenteditable]:empty:before { content: attr(placeholder); color: #aaa; display: block; }
    
    @media (max-width: 768px) { 
      .hero-title { font-size: 2.5rem; } 
      .navbar-collapse { background: #fff; padding: 15px; } 
      .admin-sidebar { min-height: auto; padding: 10px; } 
      .social-sidebar { bottom: 10px; left: 10px; } 
    }
  </style>
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
</head>
<body>

<div id="app">
  <div v-if="loading" class="loading-overlay"><div class="spinner-border text-dark" role="status"></div></div>

  <nav class="navbar navbar-expand-lg fixed-top" v-if="page !== 'admin'">
    <div class="container">
      <a class="brand-logo" href="#" @click.prevent="goPage('home')">{{ config.storeName || 'FASHION' }}</a>
      <button class="navbar-toggler border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"><span class="navbar-toggler-icon"></span></button>
      <div class="collapse navbar-collapse justify-content-end" id="navbarNav" ref="navbarCollapse">
        <ul class="navbar-nav align-items-center gap-3">
          <li class="nav-item"><a class="nav-link text-uppercase" href="#" @click.prevent="goPage('home')">é¦–é </a></li>
          <li class="nav-item"><a class="nav-link text-uppercase" href="#" @click.prevent="goPage('shop')">å…¨éƒ¨å•†å“</a></li>
          <li class="nav-item"><a class="nav-link text-uppercase" href="#" @click.prevent="goPage('news')">æœ€æ–°æ¶ˆæ¯</a></li>
          <li class="nav-item"><a class="nav-link text-uppercase" href="#" @click.prevent="goPage('guide')">è³¼ç‰©èªªæ˜</a></li>
          <li class="nav-item"><a class="nav-link text-uppercase" href="#" @click.prevent="goPage('about')">é—œæ–¼å“ç‰Œ</a></li>
          <li class="nav-item" v-if="member.name">
            <div class="dropdown">
              <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">Hi, {{ member.name }}</a>
              <ul class="dropdown-menu dropdown-menu-end border-0 shadow">
                <li><a class="dropdown-item" href="#" @click.prevent="checkOrders(); closeNavbar()">æˆ‘çš„è¨‚å–®</a></li>
                <li><hr class="dropdown-divider"></li>
                <li><a class="dropdown-item text-danger" href="#" @click.prevent="logout(); closeNavbar()">ç™»å‡º</a></li>
              </ul>
            </div>
          </li>
          <li class="nav-item" v-if="!member.name"><a class="nav-link" href="#" @click.prevent="showLoginModal=true; closeNavbar()">æœƒå“¡ç™»å…¥</a></li>
          <li class="nav-item position-relative">
            <a class="nav-link text-dark" href="#" @click.prevent="goPage('cart')">
              <i class="bi bi-cart"></i>
              <span v-if="cart.length > 0" class="badge rounded-pill bg-danger cart-badge">{{ cartTotalQty }}</span>
            </a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <div class="social-sidebar" v-if="page !== 'admin'">
    <a v-if="config.socialFb" :href="config.socialFb" target="_blank" class="social-btn fb"><i class="bi bi-facebook"></i></a>
    <a v-if="config.socialIg" :href="config.socialIg" target="_blank" class="social-btn ig"><i class="bi bi-instagram"></i></a>
    <a v-if="config.socialLine" :href="config.socialLine" target="_blank" class="social-btn line"><i class="bi bi-line"></i></a>
  </div>

  <div v-if="page === 'home'">
    <div v-if="config.marqueeText" class="marquee-container" :style="{background: config.marqueeBgColor || '#000', color: config.marqueeColor || '#fff'}"><div class="marquee-content" :style="{animationDuration: (config.marqueeSpeed || 15) + 's'}">{{ config.marqueeText }}</div></div>
    
    <div class="hero-section">
      <div id="heroCarousel" ref="heroCarousel" class="carousel slide carousel-fade h-100" data-bs-ride="carousel" v-if="config.welcomeImages && config.welcomeImages.length > 0">
        <div class="carousel-inner h-100">
          <div class="carousel-item h-100" v-for="(img, idx) in config.welcomeImages" :key="idx" :class="{active: idx===0}" :data-bs-interval="3000">
            <img :src="img" alt="Hero Image">
          </div>
        </div>
        <button class="carousel-control-prev" type="button" data-bs-target="#heroCarousel" data-bs-slide="prev">
          <span class="carousel-control-prev-icon"></span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#heroCarousel" data-bs-slide="next">
          <span class="carousel-control-next-icon"></span>
        </button>
      </div>
      <div v-else class="h-100 w-100 bg-secondary d-flex align-items-center justify-content-center text-white">No Images Configured</div>
      
      <div class="hero-overlay">
        <div class="hero-content">
          <h1 class="hero-title">{{ config.storeName }}</h1>
          <p class="lead text-white mb-4">{{ config.welcomeMsg }}</p>
          <button class="btn btn-hero" @click="page='shop'">ç«‹å³é¸è³¼</button>
        </div>
      </div>
    </div>

    <div class="container py-5">
      <h3 class="text-center mb-5 font-serif">ç†±éŠ·å–®å“</h3>
      <div class="row g-4">
        <div class="col-6 col-md-3" v-for="item in featuredProducts" :key="item.rowIndex" @click="openProductModal(item)">
          <div class="product-card">
            <div class="product-img-wrapper">
              <img :src="item.image || 'https://via.placeholder.com/300x400?text=No+Image'" class="product-img">
              <div class="tags-container">
                <span v-for="t in item.tags" :key="t" class="badge-tag" :class="{'tag-sale': t==='Hot' || t==='ç†±éŠ·' || t==='Sale'}">{{ t }}</span>
              </div>
            </div>
            <div class="mt-3 text-center">
              <h6 class="mb-1 text-uppercase">{{ item.name }}</h6>
              <p class="text-muted fw-bold">${{ item.price }}</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div v-if="page === 'shop'" class="container py-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h2 class="font-serif m-0">Collection</h2>
      <select class="form-select w-auto border-0 bg-light" v-model="filterCategory">
        <option value="All">å…¨éƒ¨å•†å“</option>
        <option v-for="c in categoriesList" :value="c.name">{{ c.name }}</option>
      </select>
    </div>
    <div class="row g-4">
      <div class="col-6 col-md-4 col-lg-3" v-for="item in filteredProducts" :key="item.rowIndex">
        <div class="product-card h-100" @click="openProductModal(item)">
          <div class="product-img-wrapper">
            <img :src="item.image || 'https://via.placeholder.com/300x400'" class="product-img">
            <div class="tags-container">
              <span v-for="t in item.tags" :key="t" class="badge-tag" :class="{'tag-sale': t==='Hot' || t==='ç†±éŠ·' || t==='Sale'}">{{ t }}</span>
            </div>
          </div>
          <div class="mt-3">
            <div class="text-muted small mb-1">{{ item.category }}</div>
            <h6 class="mb-1 text-truncate">{{ item.name }}</h6>
            <div class="d-flex justify-content-between align-items-center">
              <span class="fw-bold">${{ item.price }}</span>
              <button class="btn btn-sm btn-outline-dark rounded-0 px-3">è³¼è²·</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <div v-if="page === 'about'" class="container py-5"><div class="row justify-content-center"><div class="col-md-8 text-center"><h2 class="font-serif mb-4">é—œæ–¼å“ç‰Œ</h2><img :src="config.aboutImage || 'https://images.unsplash.com/photo-1558769132-cb1aea458c5e?auto=format&fit=crop&w=1000&q=80'" class="img-fluid mb-4 w-100" style="height: 300px; object-fit: cover;"><div class="lead text-muted mt-4 text-start" style="line-height: 1.8;" v-html="config.aboutUs || 'Loading...'"></div></div></div></div>
  
  <div v-if="page === 'guide'" class="container py-5"><div class="row justify-content-center"><div class="col-md-8"><h2 class="font-serif mb-4 text-center">è³¼ç‰©èªªæ˜</h2><div class="bg-light p-4 rounded" style="white-space: pre-wrap;" v-html="config.pageGuide || 'æš«ç„¡å…§å®¹'"></div></div></div></div>
  <div v-if="page === 'news'" class="container py-5"><div class="row justify-content-center"><div class="col-md-8"><h2 class="font-serif mb-4 text-center">æœ€æ–°æ¶ˆæ¯</h2><div class="bg-light p-4 rounded" style="white-space: pre-wrap;" v-html="config.pageNews || 'æš«ç„¡æ¶ˆæ¯'"></div></div></div></div>

  <div v-if="page === 'cart'" class="container py-5" style="max-width: 800px;">
    <h2 class="font-serif mb-4">è³¼ç‰©è»Š</h2>
    <div v-if="cart.length === 0" class="text-center py-5 bg-light"><i class="bi bi-bag fs-1 text-muted"></i><p class="mt-3">è³¼ç‰©è»Šæ˜¯ç©ºçš„</p><button class="btn btn-dark rounded-0 mt-2" @click="page='shop'">å»é€›é€›</button></div>
    <div v-else>
      <div class="card border-0 shadow-sm mb-4"><div class="card-body"><div v-for="(item, idx) in cart" :key="idx" class="d-flex align-items-center mb-3 pb-3 border-bottom"><img :src="item.image" style="width: 70px; height: 90px; object-fit: cover;" class="me-3"><div class="flex-grow-1"><div class="fw-bold">{{ item.name }}</div><div class="small text-muted">{{ item.opts }}</div><div class="text-danger">${{ item.price }}</div></div><div class="d-flex align-items-center"><button class="btn btn-sm btn-light" @click="item.qty > 1 ? item.qty-- : null">-</button><span class="mx-2">{{ item.qty }}</span><button class="btn btn-sm btn-light" @click="item.qty++">+</button></div><button class="btn btn-link text-muted ms-3" @click="cart.splice(idx, 1)"><i class="bi bi-x-lg"></i></button></div><div class="d-flex justify-content-between fw-bold fs-5"><span>å°è¨ˆ</span><span>${{ cartSubtotal }}</span></div></div></div>
      <div class="card border-0 shadow-sm">
        <div class="card-header bg-white font-serif fw-bold py-3">é‹é€èˆ‡çµå¸³è³‡è¨Š</div>
        <div class="card-body">
          <form @submit.prevent="submitOrder">
            <div class="mb-3"><label class="form-label">é‹é€æ–¹å¼</label><select class="form-select rounded-0" v-model="orderForm.shippingMethod"><option v-for="m in modes" :value="m">{{ m.name }} (é‹è²» ${{ m.fee }})</option></select></div>
            <div class="row g-3 mb-3"><div class="col-md-6"><label class="form-label">æ”¶ä»¶äººå§“å</label><input type="text" class="form-control rounded-0" v-model="orderForm.name" required></div><div class="col-md-6"><label class="form-label">è¯çµ¡é›»è©±</label><input type="tel" class="form-control rounded-0" v-model="orderForm.phone" required></div></div>
            <div class="mb-3" v-if="orderForm.shippingMethod.inputType === 'Address'"><label class="form-label">æ”¶ä»¶åœ°å€</label><input type="text" class="form-control rounded-0" v-model="orderForm.address" placeholder="è«‹è¼¸å…¥å®Œæ•´åœ°å€" required></div>
            <div class="mb-3" v-if="orderForm.shippingMethod.inputType === 'Store'"><label class="form-label">è¶…å•†/é–€å¸‚åç¨±</label><input type="text" class="form-control rounded-0" v-model="orderForm.storeName" placeholder="ä¾‹å¦‚ï¼š7-11 å°ä¸­ç¦æ˜Ÿé–€å¸‚" required></div>
            
            <div class="mb-3">
              <label class="form-label">ä»˜æ¬¾æ–¹å¼</label>
              <select class="form-select rounded-0" v-model="orderForm.paymentMethod">
                 <option v-for="pay in enabledPayments" :value="pay">{{ pay.name }}</option>
              </select>
              <div v-if="currentPayment && currentPayment.type !== 'None'" class="mt-2 p-3 bg-light rounded border">
                 <div v-if="currentPayment.type === 'Text'" style="white-space: pre-wrap;" class="mb-2 fw-bold text-primary">{{ currentPayment.content }}</div>
                 <div v-if="currentPayment.type === 'Image' && currentPayment.content" class="mb-2 text-center">
                    <img :src="currentPayment.content" style="max-width: 200px; border: 1px solid #ddd;">
                    <div class="small text-muted mt-1">è«‹æƒæä¸Šæ–¹ QR Code ä»˜æ¬¾</div>
                 </div>
                 <div v-if="currentPayment.needInput === 'Y'">
                    <label class="form-label small fw-bold text-danger">è«‹è¼¸å…¥ä»˜æ¬¾å›å ±è³‡è¨Š (å¿…å¡«)</label>
                    <input type="text" class="form-control form-control-sm" v-model="orderForm.paymentDetails" placeholder="ä¾‹å¦‚ï¼šè½‰å¸³å¾Œäº”ç¢¼ / äº¤æ˜“åºè™Ÿ" required>
                 </div>
              </div>
            </div>

            <div class="mb-3"><label class="form-label">å‚™è¨»</label><textarea class="form-control rounded-0" v-model="orderForm.note" rows="2"></textarea></div>
            <hr><div class="d-flex justify-content-between fs-4 fw-bold mb-4"><span>ç¸½é‡‘é¡</span><span class="text-danger">${{ cartSubtotal + (orderForm.shippingMethod.fee || 0) }}</span></div>
            <button type="submit" class="btn btn-dark w-100 py-3 text-uppercase rounded-0 fw-bold">ç¢ºèªä¸‹å–®</button>
          </form>
        </div>
      </div>
    </div>
  </div>
  
  <div v-if="page === 'success'" class="container py-5 text-center"><div class="my-5"><i class="bi bi-check-circle-fill text-success" style="font-size: 5rem;"></i><h2 class="mt-3 font-serif">æ„Ÿè¬æ‚¨çš„è³¼è²·ï¼</h2><p class="text-muted">è¨‚å–®ç·¨è™Ÿï¼š<span class="fw-bold text-dark">{{ lastOrderId }}</span></p><p>æˆ‘å€‘æœƒç›¡å¿«ç‚ºæ‚¨å®‰æ’å‡ºè²¨ã€‚</p></div><button class="btn btn-outline-dark rounded-0 px-5" @click="page='home'; cart=[]">å›åˆ°é¦–é </button></div>
  <div v-if="page === 'history'" class="container py-5"><h3 class="font-serif mb-4">æˆ‘çš„è¨‚å–®ç´€éŒ„</h3><div v-if="historyOrders.length===0" class="text-muted">å°šç„¡è¨‚å–®</div><div class="card mb-3 border-0 shadow-sm" v-for="order in historyOrders" :key="order.orderId"><div class="card-header bg-white d-flex justify-content-between"><span class="fw-bold">{{ order.orderId }}</span><span class="text-muted small">{{ order.date }}</span></div><div class="card-body"><div style="white-space: pre-line;" class="small mb-2">{{ order.content }}</div><div class="d-flex justify-content-between align-items-end border-top pt-2"><div><span class="badge bg-secondary">{{ order.status }}</span> <span v-if="order.tracking" class="badge bg-info text-dark ms-1">è¿½è¹¤: {{order.tracking}}</span></div><span class="fw-bold fs-5">${{ order.total }}</span></div></div></div><button class="btn btn-link text-muted mt-3" @click="page='home'">è¿”å›</button></div>

  <div v-if="page === 'admin'" class="d-flex flex-column flex-md-row" style="min-height: 100vh;">
    <div class="admin-sidebar col-md-2">
      <div class="p-3 text-center mb-4 border-bottom border-secondary">
        <h5 class="font-serif m-0">ADMIN PANEL</h5>
        <small class="text-white-50">å¾Œå°ç®¡ç†</small>
      </div>
      <div class="admin-menu-item" :class="{active: adminTab==='products'}" @click="adminTab='products'">ğŸ“¦ å•†å“ç®¡ç†</div>
      <div class="admin-menu-item" :class="{active: adminTab==='categories'}" @click="adminTab='categories'">ğŸ“‚ åˆ†é¡ç®¡ç†</div>
      <div class="admin-menu-item" :class="{active: adminTab==='orders'}" @click="adminTab='orders'">ğŸ“ƒ è¨‚å–®ç®¡ç†</div>
      <div class="admin-menu-item" :class="{active: adminTab==='members'}" @click="adminTab='members'; refreshAdminData()">ğŸ‘¥ æœƒå“¡ç®¡ç†</div>
      <div class="admin-menu-item" :class="{active: adminTab==='stats'}" @click="adminTab='stats'; refreshAdminData()">ğŸ“Š éŠ·å”®çµ±è¨ˆ</div>
      <div class="admin-menu-item" :class="{active: adminTab==='options'}" @click="adminTab='options'">ğŸ·ï¸ è¦æ ¼/é‹é€</div>
      <div class="admin-menu-item" :class="{active: adminTab==='payments'}" @click="adminTab='payments'">ğŸ’³ ä»˜æ¬¾è¨­å®š</div>
      <div class="admin-menu-item" :class="{active: adminTab==='settings'}" @click="adminTab='settings'">âš™ï¸ ç¶²ç«™è¨­å®š</div>
      <div class="admin-menu-item mt-5 text-danger" @click="adminLogout">ğŸšª ç™»å‡ºå¾Œå°</div>
    </div>
    
    <div class="admin-content col-md-10">
      <div v-if="adminTab === 'products'">
        <div class="d-flex justify-content-between align-items-center mb-4"><h3>å•†å“åˆ—è¡¨</h3><button class="btn btn-primary" @click="editProduct({})">ï¼‹ æ–°å¢å•†å“</button></div>
        <div class="bg-white rounded shadow-sm overflow-hidden"><table class="table table-hover mb-0 align-middle"><thead class="table-light"><tr><th>åœ–ç‰‡</th><th>åç¨±</th><th>åº«å­˜</th><th>åƒ¹æ ¼</th><th>ç‹€æ…‹</th><th>æ“ä½œ</th></tr></thead><tbody><tr v-for="p in products" :key="p.rowIndex"><td><img :src="p.image" style="width:40px;height:40px;object-fit:cover" class="rounded"></td><td>{{ p.name }}<br><small class="text-muted">{{p.category}}</small></td><td><span class="badge" :class="p.stock<10?'bg-danger':'bg-secondary'">{{ p.stock }}</span></td><td>${{ p.price }}</td><td><span class="badge" :class="p.status==='Y'?'bg-success':'bg-secondary'">{{ p.status }}</span></td><td><button class="btn btn-sm btn-outline-primary me-2" @click="editProduct(p)">ç·¨è¼¯</button><button class="btn btn-sm btn-outline-danger" @click="deleteProduct(p)">åˆªé™¤</button></td></tr></tbody></table></div>
      </div>
      <div v-if="adminTab === 'categories'">
        <div class="d-flex justify-content-between align-items-center mb-4"><h3>åˆ†é¡ç®¡ç†</h3><button class="btn btn-primary" @click="editCategory({})">ï¼‹ æ–°å¢åˆ†é¡</button></div>
        <div class="bg-white rounded shadow-sm overflow-hidden"><table class="table table-hover mb-0 align-middle"><thead class="table-light"><tr><th>åˆ†é¡åç¨±</th><th>æ“ä½œ</th></tr></thead><tbody><tr v-for="c in categoriesList" :key="c.rowIndex"><td>{{ c.name }}</td><td><button class="btn btn-sm btn-link" @click="editCategory(c)">ç·¨è¼¯</button><button class="btn btn-sm btn-outline-danger" @click="deleteCategory(c)">åˆªé™¤</button></td></tr></tbody></table></div>
      </div>
      <div v-if="adminTab === 'orders'">
         <div class="d-flex justify-content-between align-items-center mb-4">
           <h3>è¨‚å–®åˆ—è¡¨</h3>
           <div class="d-flex gap-2">
             <select class="form-select form-select-sm w-auto" v-model="adminOrderFilter">
                <option value="All">å…¨éƒ¨ç‹€æ…‹</option>
                <option value="è™•ç†ä¸­">è™•ç†ä¸­</option>
                <option value="å·²ç¢ºèª">å·²ç¢ºèª</option>
                <option value="å·²å‡ºè²¨">å·²å‡ºè²¨</option>
             </select>
             <input type="text" class="form-control form-control-sm" placeholder="ğŸ” æœå°‹è¨‚å–®è™Ÿ/å®¢æˆ¶/é›»è©±" v-model="adminOrderSearch">
             <button class="btn btn-sm btn-secondary" @click="refreshAdminData">é‡æ–°æ•´ç†</button>
           </div>
         </div>
         <div v-if="filteredAdminOrders.length===0" class="text-muted text-center py-5">ç„¡ç¬¦åˆè¨‚å–®</div>
         <div class="card mb-3 shadow-sm border-0" v-for="o in filteredAdminOrders" :key="o.orderId">
           <div class="card-header bg-white d-flex justify-content-between align-items-center">
             <div><strong>{{ o.orderId }}</strong> <span class="text-muted small ms-2">{{ o.date }}</span> <span v-if="o.tracking" class="badge bg-info text-dark">å–®è™Ÿ: {{o.tracking}}</span></div>
             <div class="d-flex gap-2">
               <span class="badge bg-secondary align-self-center">{{ o.status }}</span>
               <button class="btn btn-sm btn-outline-primary" @click="editOrder(o)">ç·¨è¼¯ / é…è²¨</button>
             </div>
           </div>
           <div class="card-body">
             <div class="row">
               <div class="col-md-4 mb-2"><strong>å®¢æˆ¶:</strong> {{ o.customer }}<br><small>{{ o.contact }}</small></div>
               <div class="col-md-5 mb-2 bg-light p-2 rounded"><small style="white-space:pre-wrap">{{ o.content }}</small>
               <div v-if="o.note" class="mt-1 text-danger small"><strong>å‚™è¨»:</strong> {{o.note}}</div></div>
               <div class="col-md-3 text-end"><h4 class="text-danger m-0">${{ o.total }}</h4><small class="text-muted">{{ o.method }}</small></div>
             </div>
           </div>
         </div>
      </div>
      <div v-if="adminTab === 'members'">
         <div class="d-flex justify-content-between align-items-center mb-4"><h3>æœƒå“¡ç®¡ç†</h3><div class="d-flex gap-2"><input type="text" class="form-control form-control-sm" placeholder="ğŸ” æœå°‹å§“åæˆ–é›»è©±" v-model="memberSearch"><button class="btn btn-sm btn-secondary text-nowrap" @click="refreshAdminData">é‡æ–°æ•´ç†</button></div></div>
         <div class="bg-white rounded shadow-sm overflow-hidden"><table class="table table-hover mb-0 align-middle"><thead class="table-light"><tr><th>å§“å</th><th>é›»è©±</th><th>è¨»å†Šæ—¥æœŸ</th><th class="text-end">ç´¯è¨ˆæ¶ˆè²»</th></tr></thead><tbody><tr v-for="m in filteredMembers" :key="m.phone" @click="viewMemberOrders(m)" style="cursor:pointer"><td>{{ m.name }}</td><td>{{ m.phone }}</td><td>{{ m.regDate }}</td><td class="text-end fw-bold text-danger">${{ m.spending }}</td></tr></tbody></table><div v-if="filteredMembers.length===0" class="p-4 text-center text-muted">ç„¡ç¬¦åˆè³‡æ–™</div></div>
      </div>
      <div v-if="adminTab === 'stats'">
         <h3 class="mb-4">éŠ·å”®çµ±è¨ˆ</h3>
         <div class="row g-3 mb-4 align-items-end"><div class="col-md-4"><label class="small text-muted">é–‹å§‹æ—¥æœŸ</label><input type="date" class="form-control" v-model="statsDateStart"></div><div class="col-md-4"><label class="small text-muted">çµæŸæ—¥æœŸ</label><input type="date" class="form-control" v-model="statsDateEnd"></div><div class="col-md-4"><div class="small text-muted"> </div><button class="btn btn-dark w-100" @click="refreshAdminData">æŸ¥è©¢å€é–“</button></div></div>
         <div class="row g-4 mb-4"><div class="col-md-6"><div class="bg-white p-4 rounded shadow-sm text-center border-bottom border-4 border-danger"><h6 class="text-muted">å€é–“ç¸½ç‡Ÿæ”¶</h6><h2 class="text-danger fw-bold m-0">${{ statsSummary.totalRevenue }}</h2></div></div><div class="col-md-6"><div class="bg-white p-4 rounded shadow-sm text-center border-bottom border-4 border-dark"><h6 class="text-muted">è¨‚å–®æ•¸é‡</h6><h2 class="fw-bold m-0">{{ statsSummary.totalOrders }}</h2></div></div></div>
         <div class="row g-4">
           <div class="col-md-6">
             <div class="bg-white rounded shadow-sm overflow-hidden p-4 h-100"><h5 class="mb-3">ğŸ”¥ ç†±éŠ·å•†å“ (Top 10)</h5><table class="table table-sm"><thead><tr><th>æ’å</th><th>å•†å“åç¨±</th><th class="text-end">éŠ·é‡</th></tr></thead><tbody><tr v-for="(p, idx) in statsSummary.topProducts" :key="p.name"><td>{{ idx+1 }}</td><td>{{ p.name }}</td><td class="text-end fw-bold">{{ p.qty }}</td></tr></tbody></table></div>
           </div>
           <div class="col-md-6">
             <div class="bg-white rounded shadow-sm overflow-hidden p-4 h-100"><h5 class="mb-3">ğŸ† æœƒå“¡æ¶ˆè²»æ’è¡Œ (Top 10)</h5><table class="table table-sm"><thead><tr><th>æ’å</th><th>æœƒå“¡å§“å</th><th class="text-end">é‡‘é¡</th></tr></thead><tbody><tr v-for="(m, idx) in statsSummary.topMembers" :key="m.phone"><td>{{ idx+1 }}</td><td>{{ m.name }}</td><td class="text-end fw-bold text-danger">${{ m.spending }}</td></tr></tbody></table></div>
           </div>
         </div>
      </div>
      <div v-if="adminTab === 'options'">
         <h3 class="mb-4">è¦æ ¼èˆ‡é‹é€è¨­å®š</h3>
         <div class="mb-4"><div class="d-flex justify-content-between align-items-center mb-2"><h5>è¦æ ¼é¸é … (Variants)</h5><button class="btn btn-sm btn-primary" @click="editOption({})">æ–°å¢è¦æ ¼</button></div><div class="bg-white rounded shadow-sm"><table class="table mb-0"><thead><tr><th>æ¨™é¡Œ (å¦‚:å°ºå¯¸)</th><th>å…§å®¹ (é€—è™Ÿåˆ†éš”)</th><th>ç®¡ç†åˆ†é¡ (é¸å¡«)</th><th>æ“ä½œ</th></tr></thead><tbody><tr v-for="o in options" :key="o.rowIndex"><td>{{ o.title }}</td><td>{{ o.choices.join(',') }}</td><td><small class="text-muted">{{ o.category }}</small></td><td><button class="btn btn-sm btn-link" @click="editOption(o)">ç·¨è¼¯</button><button class="btn btn-sm btn-link text-danger" @click="deleteOption(o)">åˆªé™¤</button></td></tr></tbody></table></div></div>
         <div class="mb-4"><div class="d-flex justify-content-between align-items-center mb-2"><h5>é‹é€æ–¹å¼ (Shipping)</h5><button class="btn btn-sm btn-primary" @click="editMode({})">æ–°å¢æ–¹å¼</button></div><div class="bg-white rounded shadow-sm"><table class="table mb-0"><thead><tr><th>åç¨±</th><th>é¡å‹</th><th>é‹è²»</th><th>æ“ä½œ</th></tr></thead><tbody><tr v-for="m in modes" :key="m.rowIndex"><td>{{ m.name }}</td><td>{{ m.inputType }}</td><td>${{ m.fee }}</td><td><button class="btn btn-sm btn-link" @click="editMode(m)">ç·¨è¼¯</button><button class="btn btn-sm btn-link text-danger" @click="deleteMode(m)">åˆªé™¤</button></td></tr></tbody></table></div></div>
      </div>
      <div v-if="adminTab === 'payments'">
         <div class="d-flex justify-content-between align-items-center mb-4"><h3>ä»˜æ¬¾æ–¹å¼è¨­å®š</h3><button class="btn btn-primary" @click="editPayment({})">ï¼‹ æ–°å¢æ–¹å¼</button></div>
         <div class="bg-white rounded shadow-sm overflow-hidden"><table class="table mb-0"><thead><tr><th>åç¨±</th><th>é¡å‹</th><th>éœ€å¡«å›å ±</th><th>ç‹€æ…‹</th><th>æ“ä½œ</th></tr></thead><tbody><tr v-for="p in payments" :key="p.rowIndex"><td>{{ p.name }}</td><td><span class="badge bg-light text-dark border">{{ p.type }}</span></td><td>{{ p.needInput==='Y'?'æ˜¯':'å¦' }}</td><td><span class="badge" :class="p.enabled==='Y'?'bg-success':'bg-secondary'">{{ p.enabled==='Y'?'å•Ÿç”¨':'åœç”¨' }}</span></td><td><button class="btn btn-sm btn-link" @click="editPayment(p)">ç·¨è¼¯</button><button class="btn btn-sm btn-link text-danger" @click="deletePayment(p)">åˆªé™¤</button></td></tr></tbody></table></div>
      </div>

      <div v-if="adminTab === 'settings'">
         <h3 class="mb-4">ç¶²ç«™è¨­å®š</h3>
         <div class="bg-white p-4 rounded shadow-sm" style="max-width: 600px">
            <div class="mb-3"><label class="form-label">å•†åº—åç¨±</label><input class="form-control" v-model="adminConfig.StoreName"></div>
            <div class="mb-3"><label class="form-label">ç¶²ç«™ç‹€æ…‹</label><select class="form-select" v-model="adminConfig.SystemStatus"><option value="Open">ç‡Ÿæ¥­ä¸­</option><option value="Closed">ç¶­è­·ä¸­</option></select></div>
            <div class="mb-3">
              <label class="form-label">è¨‚å–®é€šçŸ¥ Email</label>
              <div class="input-group">
                <input class="form-control" v-model="adminConfig.AdminEmail" placeholder="example@gmail.com">
                <button class="btn btn-outline-secondary" @click="sendTestEmail">ç™¼é€æ¸¬è©¦ä¿¡</button>
              </div>
            </div>
            
            <div class="mb-3"><label class="form-label">Facebook é€£çµ</label><input class="form-control" v-model="adminConfig.SocialFb"></div>
            <div class="mb-3"><label class="form-label">Instagram é€£çµ</label><input class="form-control" v-model="adminConfig.SocialIg"></div>
            <div class="mb-3"><label class="form-label">Line é€£çµ</label><input class="form-control" v-model="adminConfig.SocialLine"></div>

            <div class="mb-3"><label class="form-label">è·‘é¦¬ç‡ˆæ–‡å­—</label><input class="form-control" v-model="adminConfig.MarqueeText"></div>
            <div class="row mb-3">
              <div class="col-4"><label class="form-label">è·‘é¦¬ç‡ˆé€Ÿåº¦ (ç§’)</label><input type="number" class="form-control" v-model="adminConfig.MarqueeSpeed"></div>
              <div class="col-4"><label class="form-label">è·‘é¦¬ç‡ˆå­—è‰²</label><input type="color" class="form-control form-control-color w-100" v-model="adminConfig.MarqueeColor"></div>
              <div class="col-4"><label class="form-label">è·‘é¦¬ç‡ˆåº•è‰²</label><input type="color" class="form-control form-control-color w-100" v-model="adminConfig.MarqueeBgColor"></div>
            </div>
            
            <div class="mb-3"><label class="form-label">æ­¡è¿æ¨™èª (Hero Title)</label><input class="form-control" v-model="adminConfig.WelcomeMessage"></div>
            <div class="mb-3">
              <label class="form-label">é¦–é è¼ªæ’­åœ– URLs (æ¯è¡Œä¸€å¼µæˆ–é€—è™Ÿåˆ†éš”)</label>
              <div class="mb-2" v-for="(url, idx) in welcomeImgInputs" :key="idx">
                <div class="input-group">
                  <input type="text" class="form-control" v-model="welcomeImgInputs[idx]" placeholder="åœ–ç‰‡é€£çµ">
                  <button class="btn btn-outline-danger" @click="removeWelcomeImgInput(idx)"><i class="bi bi-trash"></i></button>
                </div>
              </div>
              <button class="btn btn-sm btn-outline-secondary" @click="addWelcomeImgInput"><i class="bi bi-plus"></i> æ–°å¢åœ–ç‰‡</button>
            </div>
            
            <div class="mb-3"><label class="form-label">é—œæ–¼å“ç‰Œåœ–ç‰‡ URL</label><input class="form-control" v-model="adminConfig.AboutImage"></div>
            <div class="mb-3">
              <label class="form-label d-flex justify-content-between">
                <span>é—œæ–¼æˆ‘å€‘ (About Text)</span><span class="text-muted small">åœ–æ–‡ç·¨è¼¯</span>
              </label>
              <div class="border rounded p-2 mb-2 bg-light">
                <div class="editor-toolbar btn-group mb-2">
                  <button class="btn btn-outline-secondary btn-sm" @click="execCmd('bold')"><b>B</b></button>
                  <input type="color" class="btn btn-outline-secondary btn-sm p-1" style="width:40px" @change="execCmd('foreColor', $event.target.value)">
                  <button class="btn btn-outline-secondary btn-sm" @click="execCmd('justifyLeft')"><i class="bi bi-text-left"></i></button>
                  <button class="btn btn-outline-secondary btn-sm" @click="execCmd('justifyCenter')"><i class="bi bi-text-center"></i></button>
                  <button class="btn btn-outline-secondary btn-sm" @click="execCmd('justifyRight')"><i class="bi bi-text-right"></i></button>
                </div>
                <div id="aboutEditor" class="form-control bg-white rich-editor" contenteditable="true" @input="updateAboutUsContent"></div>
              </div>
            </div>
            
            <div class="mb-3">
              <label class="form-label d-flex justify-content-between">
                <span>æœ€æ–°æ¶ˆæ¯ (News)</span><span class="text-muted small">åœ–æ–‡ç·¨è¼¯</span>
              </label>
              <div class="border rounded p-2 mb-2 bg-light">
                <div class="editor-toolbar btn-group mb-2">
                  <button class="btn btn-outline-secondary btn-sm" @click="execCmd('bold')"><b>B</b></button>
                  <input type="color" class="btn btn-outline-secondary btn-sm p-1" style="width:40px" @change="execCmd('foreColor', $event.target.value)">
                  <button class="btn btn-outline-secondary btn-sm" @click="execCmd('justifyLeft')"><i class="bi bi-text-left"></i></button>
                  <button class="btn btn-outline-secondary btn-sm" @click="execCmd('justifyCenter')"><i class="bi bi-text-center"></i></button>
                  <button class="btn btn-outline-secondary btn-sm" @click="execCmd('justifyRight')"><i class="bi bi-text-right"></i></button>
                </div>
                <div id="newsEditor" class="form-control bg-white rich-editor" contenteditable="true" @input="updateNewsContent"></div>
              </div>
            </div>

            <div class="mb-3">
              <label class="form-label d-flex justify-content-between">
                <span>è³¼ç‰©èªªæ˜ (Guide)</span><span class="text-muted small">åœ–æ–‡ç·¨è¼¯</span>
              </label>
              <div class="border rounded p-2 mb-2 bg-light">
                <div class="editor-toolbar btn-group mb-2">
                  <button class="btn btn-outline-secondary btn-sm" @click="execCmd('bold')"><b>B</b></button>
                  <input type="color" class="btn btn-outline-secondary btn-sm p-1" style="width:40px" @change="execCmd('foreColor', $event.target.value)">
                  <button class="btn btn-outline-secondary btn-sm" @click="execCmd('justifyLeft')"><i class="bi bi-text-left"></i></button>
                  <button class="btn btn-outline-secondary btn-sm" @click="execCmd('justifyCenter')"><i class="bi bi-text-center"></i></button>
                  <button class="btn btn-outline-secondary btn-sm" @click="execCmd('justifyRight')"><i class="bi bi-text-right"></i></button>
                </div>
                <div id="guideEditor" class="form-control bg-white rich-editor" contenteditable="true" @input="updateGuideContent"></div>
              </div>
            </div>

            <div class="mb-3"><label class="form-label">å¾Œå°ç®¡ç†å¯†ç¢¼</label><input class="form-control" v-model="adminConfig.AdminPassword"></div>
            <button class="btn btn-success w-100" @click="saveConfig">å„²å­˜æ‰€æœ‰è¨­å®š</button>
         </div>
      </div>
    </div>
  </div>

  <footer class="footer" v-if="page !== 'admin'">
    <div class="container text-center">
      <div class="mb-3"><a href="#" @click.prevent="goPage('home')" class="mx-2">é¦–é </a><a href="#" @click.prevent="goPage('shop')" class="mx-2">å•†å“</a><a href="#" @click.prevent="goPage('about')" class="mx-2">é—œæ–¼</a></div>
      <p class="small text-muted mb-2">Â© {{ new Date().getFullYear() }} {{ config.storeName || 'Fashion Store' }}.</p>
      <a href="#" @click.prevent="showAdminLogin=true" class="small text-secondary text-decoration-underline"><i class="bi bi-gear"></i> å¾Œå°ç®¡ç†</a>
    </div>
  </footer>

  <div class="modal fade" id="adminProdModal" tabindex="-1"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">{{ editingProd.rowIndex ? 'ç·¨è¼¯å•†å“' : 'æ–°å¢å•†å“' }}</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body">
      <div class="mb-2"><label>åç¨±</label><input class="form-control" v-model="editingProd.name"></div>
      <div class="row mb-2">
        <div class="col">
          <label>åˆ†é¡</label>
          <select class="form-select" v-model="editingProd.category">
             <option v-for="c in categoriesList" :value="c.name">{{ c.name }}</option>
          </select>
        </div>
        <div class="col"><label>åƒ¹æ ¼</label><input type="number" class="form-control" v-model="editingProd.price"></div>
        <div class="col"><label>åº«å­˜</label><input type="number" class="form-control" v-model="editingProd.stock"></div>
      </div>
      <div class="mb-2"><label>åœ–ç‰‡ç¶²å€</label><input class="form-control" v-model="editingProd.image" placeholder="https://..."></div>
      <div class="mb-2"><label>æè¿°</label><textarea class="form-control" v-model="editingProd.desc"></textarea></div>
      <div class="mb-2"><label>æ¨™ç±¤ (é€—è™Ÿåˆ†éš”)</label><input class="form-control" v-model="editingProd.tags" placeholder="New, Hot"></div>
      
      <div class="mb-3 border p-3 rounded bg-light">
        <label class="fw-bold mb-2 d-block text-primary">é©ç”¨è¦æ ¼ (è«‹å‹¾é¸å¯æä¾›çš„é¸é …)</label>
        <div class="row g-2">
          <div class="col-12" v-for="opt in options" :key="opt.title">
            <div class="form-check mb-1">
              <input class="form-check-input" type="checkbox" :id="'grp-'+opt.title" :checked="!!editingProd.specsObj?.[opt.title]" @change="(e) => toggleSpecGroup(opt.title, opt.choices, e.target.checked)">
              <label class="form-check-label fw-bold" :for="'grp-'+opt.title">{{ opt.title }}</label>
            </div>
            <div class="ps-4 d-flex flex-wrap gap-2 mb-2" v-if="!!editingProd.specsObj?.[opt.title]">
               <div v-for="choice in opt.choices" :key="choice" class="form-check form-check-inline">
                  <input class="form-check-input" type="checkbox" :id="'c-'+opt.title+'-'+choice" :checked="editingProd.specsObj[opt.title].includes(choice)" @change="(e) => toggleSpecChoice(opt.title, choice, e.target.checked)">
                  <label class="form-check-label small" :for="'c-'+opt.title+'-'+choice">{{ choice }}</label>
               </div>
            </div>
          </div>
        </div>
        <div v-if="options.length === 0" class="text-muted small">å°šæœªå»ºç«‹è¦æ ¼ï¼Œè«‹è‡³ã€Œè¦æ ¼/é‹é€ã€é ç±¤æ–°å¢ã€‚</div>
      </div>
      <div class="mb-2"><label>ç‹€æ…‹</label><select class="form-select" v-model="editingProd.status"><option value="Y">ä¸Šæ¶ (Y)</option><option value="N">ä¸‹æ¶ (N)</option></select></div>
  </div><div class="modal-footer"><button class="btn btn-primary" @click="saveProduct">å„²å­˜</button></div></div></div></div>
  
  <div class="modal fade" id="adminCatModal" tabindex="-1"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">åˆ†é¡ç®¡ç†</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body">
      <div class="mb-3"><label>åˆ†é¡åç¨±</label><input class="form-control" v-model="editingCat.name" placeholder="å¦‚: ä¸Šèº«é¡"></div>
  </div><div class="modal-footer"><button class="btn btn-primary" @click="saveCategory">å„²å­˜</button></div></div></div></div>

  <div class="modal fade" id="adminOrderModal" tabindex="-1"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">è¨‚å–®ç·¨è¼¯ / é…è²¨</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body">
      <div class="alert alert-secondary py-2 mb-3 small">{{ editingOrder.orderId }} - {{ editingOrder.customer }}</div>
      <div class="mb-3"><label class="form-label">è¨‚å–®ç‹€æ…‹</label><select class="form-select" v-model="editingOrder.status"><option value="è™•ç†ä¸­">è™•ç†ä¸­</option><option value="å·²ç¢ºèª">å·²ç¢ºèª</option><option value="å·²å‡ºè²¨">å·²å‡ºè²¨</option><option value="å·²å®Œæˆ">å·²å®Œæˆ</option><option value="å·²å–æ¶ˆ">å·²å–æ¶ˆ</option></select></div>
      <div class="mb-3"><label class="form-label">ç‰©æµè¿½è¹¤å–®è™Ÿ (Tracking Code)</label><input class="form-control" v-model="editingOrder.tracking" placeholder="è¼¸å…¥ç‰©æµå–®è™Ÿ"></div>
      <div class="mb-3"><label class="form-label">ç®¡ç†å“¡å‚™è¨»</label><textarea class="form-control" v-model="editingOrder.note" rows="3" placeholder="å…§éƒ¨å‚™è¨»..."></textarea></div>
  </div><div class="modal-footer"><button class="btn btn-primary" @click="saveOrder">å„²å­˜è®Šæ›´</button></div></div></div></div>

  <div class="modal fade" id="adminOptModal" tabindex="-1"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">ç·¨è¼¯è¦æ ¼</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body">
      <div class="mb-2"><label>è¦æ ¼æ¨™é¡Œ (å‰å°é¡¯ç¤º)</label><input class="form-control" v-model="editingOpt.title" placeholder="å¦‚: å°ºå¯¸"></div>
      <div class="mb-2"><label>é¸é …å…§å®¹ (é€—è™Ÿåˆ†éš”)</label><input class="form-control" v-model="editingOpt.choicesStr" placeholder="S, M, L"></div>
      <div class="mb-2"><label>ç®¡ç†åˆ†é¡ (é¸å¡«ï¼Œåƒ…ä¾›åˆ†é¡ç”¨)</label><input class="form-control" v-model="editingOpt.category" placeholder="å¦‚: ä¸Šèº«é¡"></div>
  </div><div class="modal-footer"><button class="btn btn-primary" @click="saveOption">å„²å­˜</button></div></div></div></div>
  
  <div class="modal fade" id="adminModeModal" tabindex="-1"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">ç·¨è¼¯é‹é€æ–¹å¼</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body">
      <div class="mb-2"><label>åç¨±</label><input class="form-control" v-model="editingMode.name"></div>
      <div class="mb-2"><label>é¡å‹</label><select class="form-select" v-model="editingMode.inputType"><option value="Address">å®…é… (å¡«åœ°å€)</option><option value="Store">è¶…å•† (å¡«åº—å)</option><option value="None">è‡ªå– (ç„¡)</option></select></div>
      <div class="mb-2"><label>é‹è²»</label><input type="number" class="form-control" v-model="editingMode.fee"></div>
  </div><div class="modal-footer"><button class="btn btn-primary" @click="saveMode">å„²å­˜</button></div></div></div></div>

  <div class="modal fade" id="adminPayModal" tabindex="-1"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">ç·¨è¼¯ä»˜æ¬¾æ–¹å¼</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body">
      <div class="mb-2"><label>åç¨± (å¦‚: LINE PAY)</label><input class="form-control" v-model="editingPay.name"></div>
      <div class="mb-2"><label>é¡å‹</label><select class="form-select" v-model="editingPay.type"><option value="Text">ç´”æ–‡å­— (å¦‚å¸³è™Ÿ)</option><option value="Image">åœ–ç‰‡ (å¦‚QR Code)</option><option value="None">ç„¡ (å¦‚è²¨åˆ°ä»˜æ¬¾)</option></select></div>
      <div class="mb-2" v-if="editingPay.type!=='None'"><label>å…§å®¹ (æ–‡å­—è³‡è¨Šæˆ–åœ–ç‰‡ç¶²å€)</label><input class="form-control" v-model="editingPay.content"></div>
      <div class="mb-2 form-check form-switch"><input class="form-check-input" type="checkbox" v-model="editingPay.needInput" true-value="Y" false-value="N"><label class="form-check-label">éœ€å¡«å›å ±è³‡è¨Š (å¦‚å¾Œäº”ç¢¼)</label></div>
      <div class="mb-2 form-check form-switch"><input class="form-check-input" type="checkbox" v-model="editingPay.enabled" true-value="Y" false-value="N"><label class="form-check-label">å•Ÿç”¨</label></div>
  </div><div class="modal-footer"><button class="btn btn-primary" @click="savePayment">å„²å­˜</button></div></div></div></div>

  <div class="modal fade" id="adminMemberOrderModal" tabindex="-1"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">æœƒå“¡æ­·å²è¨‚å–®</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body">
      <div v-if="adminMemberOrders.length===0" class="text-center py-4 text-muted">ç„¡è¨‚å–®è¨˜éŒ„</div>
      <div v-for="o in adminMemberOrders" :key="o.orderId" class="card mb-2"><div class="card-body py-2">
         <div class="d-flex justify-content-between"><strong>{{o.orderId}}</strong> <span>{{o.date}}</span></div>
         <div class="small text-muted">{{o.content}}</div>
         <div class="d-flex justify-content-between mt-1"><div><span class="badge bg-secondary">{{o.status}}</span> <span v-if="o.tracking" class="badge bg-info text-dark ms-1">è¿½è¹¤: {{o.tracking}}</span></div><span class="fw-bold text-danger">${{o.total}}</span></div>
      </div></div>
  </div></div></div></div>

  <div class="modal fade" id="productModal" tabindex="-1"><div class="modal-dialog modal-dialog-centered modal-lg"><div class="modal-content rounded-0 border-0" v-if="modalItem"><div class="modal-header border-0"><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body pt-0"><div class="row"><div class="col-md-6 mb-3"><img :src="modalItem.image" class="w-100" style="object-fit: cover; aspect-ratio: 3/4;"></div><div class="col-md-6"><h3 class="font-serif mb-2">{{ modalItem.name }}</h3><div class="fs-4 fw-bold text-danger mb-3">${{ modalItem.price }}</div><p class="text-muted small" style="line-height:1.6">{{ modalItem.desc }}</p><hr>
      <div v-if="modalOptions.length > 0">
        <div v-for="(optGroup, idx) in modalOptions" :key="idx" class="mb-3">
          <label class="fw-bold small mb-2 d-block">{{ optGroup.title }}</label>
          <div class="d-flex flex-wrap"><button type="button" class="btn spec-btn" v-for="choice in optGroup.choices" :class="{active: selectedOpts[optGroup.title] === choice}" @click="selectedOpts[optGroup.title] = choice">{{ choice }}</button></div>
        </div>
      </div>
      <div v-else class="text-muted small mb-3">æ­¤å•†å“ç„¡è¦æ ¼é¸é …</div>
      <div class="mb-4"><label class="fw-bold small mb-2 d-block">æ•¸é‡</label><div class="input-group" style="width: 140px;"><button class="btn btn-outline-secondary rounded-0" @click="modalQty > 1 ? modalQty-- : null">-</button><input type="text" class="form-control text-center border-secondary" :value="modalQty" readonly><button class="btn btn-outline-secondary rounded-0" @click="modalQty++">+</button></div></div><button class="btn btn-dark w-100 py-3 rounded-0 text-uppercase fw-bold" @click="addToCart">åŠ å…¥è³¼ç‰©è»Š</button></div></div></div></div></div></div>
  <div v-if="showAdminLogin" class="modal show d-block" style="background: rgba(0,0,0,0.5)"><div class="modal-dialog modal-dialog-centered"><div class="modal-content p-4 text-center"><h4 class="mb-3">ç®¡ç†å“¡ç™»å…¥</h4><input type="password" class="form-control mb-3" placeholder="è«‹è¼¸å…¥å¾Œå°å¯†ç¢¼" v-model="adminPin"><button class="btn btn-dark w-100" @click="adminLogin">ç™»å…¥</button><button class="btn btn-link w-100 mt-2" @click="showAdminLogin=false">å–æ¶ˆ</button></div></div></div>
  <div v-if="showLoginModal" class="modal show d-block" style="background: rgba(0,0,0,0.5)"><div class="modal-dialog modal-dialog-centered"><div class="modal-content rounded-0 p-4"><h4 class="font-serif text-center mb-4">æœƒå“¡ç™»å…¥</h4><input type="tel" class="form-control rounded-0 mb-3" placeholder="æ‰‹æ©Ÿè™Ÿç¢¼" v-model="loginData.phone"><input type="password" class="form-control rounded-0 mb-3" placeholder="å¯†ç¢¼" v-model="loginData.password"><button class="btn btn-dark w-100 rounded-0 mb-2" @click="login">ç™»å…¥</button><button class="btn btn-link text-muted w-100" @click="showLoginModal=false; showRegModal=true">é‚„æ²’è¨»å†Šï¼Ÿ</button><button class="btn-close position-absolute top-0 end-0 m-3" @click="showLoginModal=false"></button></div></div></div>
  <div v-if="showRegModal" class="modal show d-block" style="background: rgba(0,0,0,0.5)"><div class="modal-dialog modal-dialog-centered"><div class="modal-content rounded-0 p-4"><h4 class="font-serif text-center mb-4">è¨»å†Šæœƒå“¡</h4><input type="text" class="form-control rounded-0 mb-3" placeholder="å§“å" v-model="regData.name"><input type="tel" class="form-control rounded-0 mb-3" placeholder="æ‰‹æ©Ÿè™Ÿç¢¼" v-model="regData.phone"><input type="text" class="form-control rounded-0 mb-3" placeholder="è¨­å®šå¯†ç¢¼" v-model="regData.password"><button class="btn btn-dark w-100 rounded-0 mb-2" @click="register">è¨»å†Š</button><button class="btn btn-link text-muted w-100" @click="showRegModal=false; showLoginModal=true">è¿”å›ç™»å…¥</button></div></div></div>
</div>

<script>
// ==========================================
// è«‹å°‡æ‚¨çš„ Google Apps Script éƒ¨ç½²ç¶²å€è²¼åœ¨é€™è£¡
const GAS_API_URL = "https://script.google.com/macros/s/AKfycbz3dgatcqmkJYSyDUymTxP0VGkM3iL0HlavPaJA7dRDBKDHTDCvmWVr7VAhjYfP12mBlg/exec";
// ==========================================

const { createApp } = Vue;
const bsModals = {};
const getModal = (id) => { if(!bsModals[id]) bsModals[id] = new bootstrap.Modal(document.getElementById(id)); return bsModals[id]; }

createApp({
  data() {
    return {
      loading: false, page: 'home', config: {}, products: [], categoriesList: [], options: [], modes: [], payments: [],
      filterCategory: 'All', cart: [], modalItem: null, modalQty: 1, modalOptions: [], selectedOpts: {},
      orderForm: { name: '', phone: '', address: '', storeName: '', note: '', shippingMethod: {}, paymentMethod: '', paymentDetails: '' },
      lastOrderId: '', member: {}, showLoginModal: false, showRegModal: false,
      loginData: {phone:'', password:''}, regData: {name:'', phone:'', password:''}, historyOrders: [],
      
      // Admin Data
      showAdminLogin: false, adminPin: '', isAdmin: false, adminTab: 'products',
      adminOrders: [], adminMembers: [], adminConfig: {}, adminMemberOrders: [], adminOrderFilter: 'All',
      editingProd: { specsObj: {} }, editingOpt: {}, editingMode: {}, editingCat: {}, editingOrder: {}, editingPay: {},
      welcomeImgInputs: [],
      
      memberSearch: '', adminOrderSearch: '',
      statsDateStart: new Date().toISOString().split('T')[0],
      statsDateEnd: new Date().toISOString().split('T')[0]
    }
  },
  mounted() {
    document.addEventListener('click', (e) => {
       const navEl = this.$refs.navbarCollapse;
       const toggleBtn = document.querySelector('.navbar-toggler');
       if (navEl && navEl.classList.contains('show') && !navEl.contains(e.target) && !toggleBtn.contains(e.target)) {
          this.closeNavbar();
       }
    });
    this.fetchStoreData(); 
  },
  updated() {
    if (this.$refs.heroCarousel) {
      new bootstrap.Carousel(this.$refs.heroCarousel, { interval: 3000, ride: 'carousel' });
    }
  },
  computed: {
    categories() { return [...new Set(this.products.map(p => p.category))]; },
    filteredProducts() { return this.filterCategory === 'All' ? this.products : this.products.filter(p => p.category === this.filterCategory); },
    featuredProducts() { return this.products.filter(p => p.tags.includes('New') || p.tags.includes('Hot')).slice(0, 4); },
    cartTotalQty() { return this.cart.reduce((sum, i) => sum + i.qty, 0); },
    cartSubtotal() { return this.cart.reduce((sum, i) => sum + (i.price * i.qty), 0); },
    
    enabledPayments() { return this.payments.filter(p => p.enabled === 'Y'); },
    currentPayment() { return this.orderForm.paymentMethod; },

    // Admin Computed
    filteredMembers() {
      if(!this.memberSearch) return this.adminMembers;
      const s = this.memberSearch.toLowerCase();
      return this.adminMembers.filter(m => m.name.toLowerCase().includes(s) || m.phone.includes(s));
    },
    filteredAdminOrders() {
      let orders = this.adminOrders;
      if (this.adminOrderFilter !== 'All') {
         orders = orders.filter(o => o.status === this.adminOrderFilter);
      }
      if (this.adminOrderSearch) {
         const s = this.adminOrderSearch.toLowerCase();
         orders = orders.filter(o => o.orderId.toLowerCase().includes(s) || o.customer.toLowerCase().includes(s) || o.contact.includes(s));
      }
      return orders;
    },
    statsSummary() {
      if (!this.adminOrders || this.adminOrders.length === 0) return { totalRevenue: 0, totalOrders: 0, topProducts: [], topMembers: [] };
      
      const start = new Date(this.statsDateStart); start.setHours(0,0,0,0);
      const end = new Date(this.statsDateEnd); end.setHours(23,59,59,999);
      
      let rev = 0, count = 0, prodMap = {}, memberSpendingMap = {};
      
      this.adminOrders.forEach(o => {
        const d = new Date(o.date);
        if (d >= start && d <= end && o.status !== 'å·²å–æ¶ˆ') {
          rev += Number(o.total || 0);
          count++;
          const lines = (o.content || "").split('\n');
          lines.forEach(line => {
             const match = line.match(/^(.+?)\s.*x(\d+)/);
             if(match) {
               const name = match[1].trim();
               const qty = parseInt(match[2]) || 0;
               prodMap[name] = (prodMap[name] || 0) + qty;
             }
          });
          const phoneMatch = o.contact.match(/é›»è©±:\s*([0-9\-]+)/);
          if (phoneMatch) {
             const phone = phoneMatch[1].trim();
             if (!memberSpendingMap[phone]) memberSpendingMap[phone] = {name: o.customer, spending: 0};
             memberSpendingMap[phone].spending += Number(o.total || 0);
          }
        }
      });
      
      const topProd = Object.keys(prodMap).map(k => ({name: k, qty: prodMap[k]})).sort((a,b)=>b.qty - a.qty).slice(0, 10);
      const topMem = Object.values(memberSpendingMap).sort((a,b)=>b.spending - a.spending).slice(0, 10);
      
      return { totalRevenue: rev, totalOrders: count, topProducts: topProd, topMembers: topMem };
    }
  },
  methods: {
    // æ ¸å¿ƒ API è«‹æ±‚å‡½å¼ (Fetch Version)
    async fetchApi(action, payload = {}) {
      if(!GAS_API_URL || GAS_API_URL.includes("æ‚¨çš„_GAS_API")) {
         alert("å°šæœªè¨­å®š GAS API ç¶²å€");
         return { success: false, error: "No API URL" };
      }
      this.loading = true;
      try {
        // ä½¿ç”¨ POST text/plain é¿å… CORS preflight
        const response = await fetch(GAS_API_URL, {
          method: 'POST',
          body: JSON.stringify({ action: action, data: payload }),
          headers: { "Content-Type": "text/plain" }
        });
        const res = await response.json();
        this.loading = false;
        return res;
      } catch (err) {
        this.loading = false;
        console.error(err);
        return { success: false, error: "Network Error" };
      }
    },

    goPage(p) { this.page = p; this.closeNavbar(); },
    closeNavbar() {
       const navEl = this.$refs.navbarCollapse;
       if (navEl && navEl.classList.contains('show')) {
          const bsCollapse = new bootstrap.Collapse(navEl, {toggle: false});
          bsCollapse.hide();
       }
    },

    // --- Front Actions ---
    async fetchStoreData() {
      const res = await this.fetchApi('getStoreData', { password: this.adminPin });
      if (res.products) {
         this.products = res.products; this.options = res.options; this.modes = res.modes;
         this.payments = res.payments || [];
         this.categoriesList = res.categories;
         this.config = res.config;
         if(res.config.rawConfig) this.adminConfig = res.config.rawConfig; 
         if(this.modes.length > 0 && !this.orderForm.shippingMethod.name) this.orderForm.shippingMethod = this.modes[0];
         if(this.enabledPayments.length > 0 && !this.orderForm.paymentMethod) this.orderForm.paymentMethod = this.enabledPayments[0];
      }
    },
    openProductModal(item) {
      this.modalItem = item; this.modalQty = 1; this.selectedOpts = {};
      
      this.modalOptions = [];
      if (item.specs && typeof item.specs === 'object' && !Array.isArray(item.specs) && !item.specs._legacy) {
         for (const [title, choices] of Object.entries(item.specs)) {
            if (choices && choices.length > 0) {
               this.modalOptions.push({ title: title, choices: choices });
            }
         }
      } else {
         this.modalOptions = this.options.filter(o => o.category === item.category);
      }

      this.modalOptions.forEach(g => { if(g.choices.length > 0) this.selectedOpts[g.title] = g.choices[0]; });
      getModal('productModal').show();
    },
    addToCart() {
      if (!this.member.name) { alert('è«‹å…ˆç™»å…¥æœƒå“¡æ‰èƒ½è³¼è²·'); this.showLoginModal = true; getModal('productModal').hide(); return; }
      if (this.modalItem.stock < this.modalQty) { alert('åº«å­˜ä¸è¶³'); return; }
      
      for (let g of this.modalOptions) { if (!this.selectedOpts[g.title]) { alert(`è«‹é¸æ“‡ ${g.title}`); return; } }
      let optStr = Object.values(this.selectedOpts).join(' / ');
      this.cart.push({ ...this.modalItem, qty: this.modalQty, opts: optStr });
      getModal('productModal').hide(); alert('å·²åŠ å…¥è³¼ç‰©è»Š');
    },
    async submitOrder() {
      if (!this.member.name) { alert('è«‹å…ˆç™»å…¥æœƒå“¡'); this.showLoginModal = true; return; }
      
      if (this.currentPayment.needInput === 'Y' && !this.orderForm.paymentDetails) {
         alert('è«‹è¼¸å…¥ä»˜æ¬¾è³‡è¨Š (å¦‚å¾Œäº”ç¢¼)');
         return;
      }

      const payload = { 
         name: this.orderForm.name, phone: this.orderForm.phone, address: this.orderForm.address, 
         storeName: this.orderForm.storeName, note: this.orderForm.note, 
         inputType: this.orderForm.shippingMethod.inputType, 
         shippingMethod: this.orderForm.shippingMethod.name, shippingFee: this.orderForm.shippingMethod.fee, 
         paymentMethod: this.orderForm.paymentMethod.name,
         paymentDetails: this.orderForm.paymentDetails,
         subtotal: this.cartSubtotal, cart: this.cart, memberPhone: this.member.phone 
      };
      const res = await this.fetchApi('submitOrder', { payload });
      if (res.success) { this.lastOrderId = res.orderId; this.page = 'success'; this.cart = []; } else alert(res.error);
    },
    async login() { const res = await this.fetchApi('login', this.loginData); if(res.success) { this.member = res; this.orderForm.name = res.name; this.orderForm.phone = res.phone; this.showLoginModal = false; } else alert(res.error); },
    async register() { const res = await this.fetchApi('register', this.regData); if(res.success) { alert('è¨»å†ŠæˆåŠŸ'); this.showRegModal = false; this.showLoginModal = true; } else alert(res.error); },
    logout() { this.member = {}; this.page = 'home'; },
    async checkOrders() { const res = await this.fetchApi('getMemberOrders', { phone: this.member.phone }); if(res.success) { this.historyOrders = res.orders; this.page = 'history'; } },

    // --- Admin Actions ---
    async adminLogin() {
       const res = await this.fetchApi('getStoreData', { password: this.adminPin });
       if (res.isAdmin) {
          this.isAdmin = true; 
          this.showAdminLogin = false; 
          this.page = 'admin';
          this.products = res.products; 
          this.adminConfig = res.config.rawConfig;
          this.refreshAdminData();
       } else {
          alert('å¯†ç¢¼éŒ¯èª¤');
       }
    },
    adminLogout() { this.isAdmin = false; this.adminPin = ''; this.page = 'home'; },
    async refreshAdminData() {
       const resOrders = await this.fetchApi('getAdminOrders', { password: this.adminPin });
       if(resOrders.success) this.adminOrders = resOrders.orders;
       
       if(this.adminTab === 'members') {
         const resMem = await this.fetchApi('getAdminMembers', { password: this.adminPin });
         if(resMem.success) this.adminMembers = resMem.members;
       }
    },
    async viewMemberOrders(member) {
       const res = await this.fetchApi('getMemberDetailAdmin', { password: this.adminPin, targetPhone: member.phone });
       if(res.success) {
          this.adminMemberOrders = res.orders;
          getModal('adminMemberOrderModal').show();
       } else {
          alert("æŸ¥è©¢å¤±æ•—");
       }
    },
    async doAdminAction(subAction, payload) {
       const res = await this.fetchApi('adminAction', { password: this.adminPin, subAction, payload });
       if(res.success) { 
          alert('æ“ä½œæˆåŠŸ'); 
          this.fetchStoreData();
          if(subAction === 'updateOrderDetails') this.refreshAdminData();
          return true;
       } else {
          alert('å¤±æ•—: ' + res.error);
          return false;
       }
    },
    async sendTestEmail() {
      if(!this.adminConfig.AdminEmail) return alert("è«‹å…ˆè¼¸å…¥ Email");
      const res = await this.fetchApi('testEmail', { password: this.adminPin, email: this.adminConfig.AdminEmail });
      if(res.success) alert("æ¸¬è©¦ä¿¡å·²ç™¼é€ï¼Œè«‹æª¢æŸ¥æ”¶ä»¶åŒ£ (å«åƒåœ¾éƒµä»¶)");
      else alert("ç™¼é€å¤±æ•—: " + res.error);
    },
    
    // Rich Text Editor
    execCmd(cmd, val) { document.execCommand(cmd, false, val); },
    updateAboutUsContent(e) { this.adminConfig.AboutUs = e.target.innerHTML; },
    updateNewsContent(e) { this.adminConfig.PageNews = e.target.innerHTML; },
    updateGuideContent(e) { this.adminConfig.PageGuide = e.target.innerHTML; },
    
    initEditors() {
       const setHTML = (id, html) => { const el = document.getElementById(id); if(el && html) el.innerHTML = html; };
       setHTML('aboutEditor', this.adminConfig.AboutUs);
       setHTML('newsEditor', this.adminConfig.PageNews);
       setHTML('guideEditor', this.adminConfig.PageGuide);
    },
    
    syncEditors() {
       const getHTML = (id) => document.getElementById(id)?.innerHTML || "";
       this.adminConfig.AboutUs = getHTML('aboutEditor');
       this.adminConfig.PageNews = getHTML('newsEditor');
       this.adminConfig.PageGuide = getHTML('guideEditor');
    },
    
    // Dynamic Welcome Images
    addWelcomeImgInput() { this.welcomeImgInputs.push(''); },
    removeWelcomeImgInput(index) { this.welcomeImgInputs.splice(index, 1); },
    
    saveConfig() { 
       this.syncEditors();
       this.adminConfig.WelcomeImage = this.welcomeImgInputs.filter(url => url.trim() !== '').join(',');
       this.doAdminAction('saveConfig', this.adminConfig); 
    },
    
    // Product Edit
    editProduct(p) { 
      this.editingProd = JSON.parse(JSON.stringify(p)); 
      if(!this.editingProd.status) this.editingProd.status='Y';
      if(!this.editingProd.specsObj) this.editingProd.specsObj = {};
      if(this.editingProd.specs && !Array.isArray(this.editingProd.specs) && !this.editingProd.specs._legacy) {
         this.editingProd.specsObj = this.editingProd.specs;
      }
      getModal('adminProdModal').show(); 
    },
    toggleSpecGroup(title, allChoices, checked) {
       if (checked) { this.editingProd.specsObj[title] = [...allChoices]; } else { delete this.editingProd.specsObj[title]; }
    },
    toggleSpecChoice(title, choice, checked) {
       if (!this.editingProd.specsObj[title]) return;
       if (checked) { if (!this.editingProd.specsObj[title].includes(choice)) this.editingProd.specsObj[title].push(choice); } 
       else { const idx = this.editingProd.specsObj[title].indexOf(choice); if (idx > -1) this.editingProd.specsObj[title].splice(idx, 1); }
    },
    async saveProduct() { 
       this.editingProd.specs = JSON.stringify(this.editingProd.specsObj);
       const success = await this.doAdminAction('saveProduct', this.editingProd);
       if(success) getModal('adminProdModal').hide();
    },
    async deleteProduct(p) { if(confirm('ç¢ºå®šåˆªé™¤?')) this.doAdminAction('deleteProduct', {rowIndex: p.rowIndex}); },
    
    // Category Edit
    editCategory(c) { this.editingCat = JSON.parse(JSON.stringify(c)); getModal('adminCatModal').show(); },
    async saveCategory() { const success = await this.doAdminAction('saveCategory', this.editingCat); if(success) getModal('adminCatModal').hide(); },
    async deleteCategory(c) { if(confirm('ç¢ºå®šåˆªé™¤?')) this.doAdminAction('deleteCategory', {rowIndex: c.rowIndex}); },

    // Option Edit
    editOption(o) { this.editingOpt = JSON.parse(JSON.stringify(o)); this.editingOpt.choicesStr = (o.choices||[]).join(','); getModal('adminOptModal').show(); },
    async saveOption() { 
       this.editingOpt.choices = this.editingOpt.choicesStr.split(',').map(s=>s.trim());
       const success = await this.doAdminAction('saveOption', this.editingOpt);
       if(success) getModal('adminOptModal').hide();
    },
    async deleteOption(o) { if(confirm('ç¢ºå®šåˆªé™¤?')) this.doAdminAction('deleteOption', {rowIndex: o.rowIndex}); },
    
    // Mode Edit
    editMode(m) { this.editingMode = JSON.parse(JSON.stringify(m)); getModal('adminModeModal').show(); },
    async saveMode() { const success = await this.doAdminAction('saveMode', this.editingMode); if(success) getModal('adminModeModal').hide(); },
    async deleteMode(m) { if(confirm('ç¢ºå®šåˆªé™¤?')) this.doAdminAction('deleteMode', {rowIndex: m.rowIndex}); },
    
    // Payment Edit
    editPayment(p) { this.editingPay = JSON.parse(JSON.stringify(p)); if(!this.editingPay.enabled) this.editingPay.enabled='Y'; getModal('adminPayModal').show(); },
    async savePayment() { const success = await this.doAdminAction('savePayment', this.editingPay); if(success) getModal('adminPayModal').hide(); },
    async deletePayment(p) { if(confirm('ç¢ºå®šåˆªé™¤?')) this.doAdminAction('deletePayment', {rowIndex: p.rowIndex}); },

    // Order Edit
    editOrder(o) { this.editingOrder = JSON.parse(JSON.stringify(o)); getModal('adminOrderModal').show(); },
    async saveOrder() {
       const success = await this.doAdminAction('updateOrderDetails', this.editingOrder);
       if(success) getModal('adminOrderModal').hide();
    },
    async updateOrderStatus(o) {
       await this.doAdminAction('updateOrderDetails', { orderId: o.orderId, status: o.status });
    }
  },
  watch: {
    adminTab(newVal) {
       if(newVal === 'settings') {
          this.welcomeImgInputs = this.adminConfig.WelcomeImage ? this.adminConfig.WelcomeImage.split(',') : [];
          setTimeout(() => this.initEditors(), 100);
       }
    }
  }
}).mount('#app');
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
